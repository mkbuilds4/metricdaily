(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{96981:function(e,t,a){Promise.resolve().then(a.bind(a,2512))},2512:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return B}});var s=a(57437),l=a(2265),r=a(87138),i=a(48185),n=a(8618),o=a(76780),d=e=>{let{initialWorkLogs:t=[],initialUphTargets:a=[],initialActiveTarget:l=null,deleteWorkLogAction:r,setActiveUPHTargetAction:d,onGoalMet:c}=e,m=t.length>0?t[0]:null,u=(null==m?void 0:m.targetId)?a.find(e=>e.id===m.targetId):null,x=null!=u?u:l,f=a.filter(e=>{var t;return null===(t=e.isDisplayed)||void 0===t||t});return(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Today's Metrics"}),x?(0,s.jsxs)(i.SZ,{className:"text-sm mt-1",children:["Metrics calculated against: ",(0,s.jsx)("span",{className:"font-medium",children:x.name})," (Goal UPH: ",x.targetUPH.toFixed(1),")",!u&&l&&(null==m?void 0:m.targetId)&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground ml-1",children:"(Log's original target missing, using active)"}),!u&&l&&!(null==m?void 0:m.targetId)&&m&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground ml-1",children:"(Using active target)"}),(0,s.jsx)("br",{})," ",(0,s.jsx)("span",{className:"text-xs italic text-muted-foreground",children:"Click a card below to set it as the active target for the dashboard."})]}):m&&a.length>0?(0,s.jsxs)(i.SZ,{className:"text-sm text-destructive mt-1 flex items-center gap-1",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"})," No active UPH target set or target for today's log not found. Define/activate one in Log / Targets."]}):m||0!==a.length?m?0===a.length?(0,s.jsx)(i.SZ,{className:"text-sm text-muted-foreground mt-1",children:"No UPH targets defined yet. Add one in Log / Targets."}):null:(0,s.jsx)(i.SZ,{className:"text-sm text-muted-foreground mt-2",children:"No work log recorded for today yet. Add one in Log / Targets to see metrics."}):(0,s.jsx)(i.SZ,{className:"text-sm text-muted-foreground mt-2",children:"No work log recorded for today and no UPH targets defined yet."})]}),(0,s.jsx)(i.aY,{children:(0,s.jsx)(n.Z,{allWorkLogs:t,targets:f,deleteWorkLogAction:r,setActiveUPHTargetAction:d,onGoalMet:c,showTodaySection:!0})})]})},c=a(89733),m=a(70518),u=a(87592),x=a(78335),f=a(1774),g=a(70218),p=a(80624),h=a(4716),v=a(5296),j=a(90620),N=a(49354),w=a(8120);let y="weeklyAverageSelectedTargetId";var b=e=>{let{allWorkLogs:t=[],targets:a=[],activeTarget:r}=e,[n,d]=(0,l.useState)(new Date),[b,k]=(0,l.useState)(void 0);(0,l.useEffect)(()=>{d(new Date);{let e=localStorage.getItem(y),t=a.filter(e=>{var t;return null===(t=e.isDisplayed)||void 0===t||t});e&&t.some(t=>t.id===e)?k(e):(null==r?void 0:r.id)&&t.some(e=>e.id===r.id)?k(r.id):t.length>0?k(t[0].id):a.length>0?k(a[0].id):k(void 0)}},[r,a]);let S=(0,l.useCallback)(e=>{k(e),e?localStorage.setItem(y,e):localStorage.removeItem(y)},[]),C=(0,l.useMemo)(()=>a.find(e=>e.id===b),[a,b]),T=(0,l.useMemo)(()=>{if(!C||0===t.length)return{averageUPH:null,dailyBreakdown:[]};let e=(0,f.z)(n,{weekStartsOn:1}),s=(0,g.v)(n,{weekStartsOn:1}),l=t.filter(t=>{try{let a=(0,p.D)(t.date+"T00:00:00");return(0,h.J)(a)&&(0,v._)(a,{start:e,end:s})}catch(e){return console.warn("Invalid date format for log: ".concat(t.id,", date: ").concat(t.date)),!1}});if(0===l.length)return{averageUPH:0,dailyBreakdown:[]};let r=0,i=0,o=[];return l.forEach(e=>{var t;let s=null!==(t=a.find(t=>t.id===e.targetId))&&void 0!==t?t:C;if(s){let t=(0,N.Jf)(e,s);if(t>0&&Number.isFinite(t)){r+=t,i++;try{let a=(0,p.D)(e.date+"T00:00:00");(0,h.J)(a)&&o.push({date:e.date,uph:parseFloat(t.toFixed(2)),formattedDate:(0,j.WU)(a,"EEE")})}catch(t){console.warn("Could not parse date for daily breakdown: ".concat(e.date))}}}}),o.sort((e,t)=>e.date.localeCompare(t.date)),{averageUPH:i>0?parseFloat((r/i).toFixed(2)):0,dailyBreakdown:o}},[t,C,n,a]),D=(0,j.WU)((0,f.z)(n,{weekStartsOn:1}),"MMM d"),M=(0,j.WU)((0,g.v)(n,{weekStartsOn:1}),"MMM d"),z=(0,f.z)(n,{weekStartsOn:1}).getTime()===(0,f.z)(new Date,{weekStartsOn:1}).getTime(),U=(0,l.useMemo)(()=>a.filter(e=>{var t;return null===(t=e.isDisplayed)||void 0===t||t}).map(e=>({value:e.id,label:"".concat(e.name," (Goal: ").concat(e.targetUPH.toFixed(1),")")})),[a]);return(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{className:"pb-2",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(i.ll,{children:"Weekly Avg UPH"}),(0,s.jsxs)(i.SZ,{className:"whitespace-nowrap text-xs",title:"Average UPH calculated from ".concat(D," to ").concat(M),children:[D," - ",M]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 self-start sm:self-center",children:[(0,s.jsxs)(c.z,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>{d(e=>(0,x.j)(e,-1))},children:[(0,s.jsx)(m.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Previous Week"})]}),(0,s.jsxs)(c.z,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>{(0,f.z)((0,x.j)(n,1),{weekStartsOn:1})<=(0,f.z)(new Date,{weekStartsOn:1})&&d(e=>(0,x.j)(e,1))},disabled:z,children:[(0,s.jsx)(u.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Next Week"})]})]})]}),U.length>0&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(w.h,{options:U,value:b,onSelect:e=>S(e),placeholder:"Select Target for Avg UPH",searchPlaceholder:"Search targets...",notFoundText:"No targets found.",triggerClassName:"h-8 text-xs w-full sm:w-[200px]",disabled:0===U.length})})]}),(0,s.jsxs)(i.aY,{className:"pt-2 flex flex-col justify-center h-[calc(100%-6rem)]",children:[" ",null!==T.averageUPH&&C?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"text-center mb-2",children:[(0,s.jsxs)("div",{className:(0,N.cn)("text-2xl font-bold tabular-nums",C&&0!==T.averageUPH&&null!==T.averageUPH&&(T.averageUPH>=C.targetUPH?"text-green-600 dark:text-green-500":"text-red-600 dark:text-red-500")),children:[T.averageUPH>0?T.averageUPH.toFixed(2):"-",(0,s.jsx)("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"UPH"})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-0.5",title:"Calculated based on Target: ".concat((null==C?void 0:C.name)||"N/A"),children:["(Target: ",(null==C?void 0:C.name)||"N/A",")"]})]}),T.dailyBreakdown.length>0&&(0,s.jsxs)("div",{className:"mt-2 pt-2 border-t border-border/50",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-muted-foreground text-center mb-1",children:"Daily UPH"}),(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-x-3 gap-y-1",children:T.dailyBreakdown.map(e=>(0,s.jsxs)("div",{className:"text-xs flex items-center gap-1 text-muted-foreground",title:"".concat((0,N.L0)((0,p.D)(e.date+"T00:00:00")),": ").concat(e.uph),children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.formattedDate,":"]}),(0,s.jsx)("span",{className:"font-semibold text-foreground tabular-nums",children:e.uph})]},e.date))})]})]}):(0,s.jsxs)("p",{className:"text-muted-foreground text-sm text-center flex items-center gap-1 mx-auto",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"})," No target selected or available."]})]})]})},k=a(52431);let S=l.forwardRef((e,t)=>{let{className:a,value:l,...r}=e;return(0,s.jsx)(k.fC,{ref:t,className:(0,N.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...r,children:(0,s.jsx)(k.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});S.displayName=k.fC.displayName;var C=a(54461),T=a(79869),D=a(92940),M=e=>{let{todayLog:t,activeTarget:a,currentTime:r}=e,n=(0,l.useMemo)(()=>{var e;if(!t||!a||!r)return{currentUnits:0,targetUnits:0,percentage:0,currentUPH:0,timeDiff:null,projectedHitTimeFormatted:"-",unitsToGoal:0,goalMetTime:null};let s=null===(e=t.goalMetTimes)||void 0===e?void 0:e[a.id],l=s?(0,p.D)(s):null,i=l&&(0,h.J)(l),{currentUnits:n,currentUPH:o}=(0,N.NB)(t,a,r),d=(0,N.mO)(t.hoursWorked,a.targetUPH),c=null,m="-";return i?(c=0,m="-"):(c=(0,N.mS)(t,a,r),m=(0,N.oB)(t,a,c,r)),{currentUnits:n,targetUnits:d,percentage:parseFloat((d>0?Math.min(100,Math.max(0,n/d*100)):0).toFixed(1)),currentUPH:o,timeDiff:c,projectedHitTimeFormatted:m,unitsToGoal:parseFloat((d-n).toFixed(2)),goalMetTime:i?l:null}},[t,a,r]);if(!t||!r)return(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Today's Target Progress"}),(0,s.jsx)(i.SZ,{children:"Loading or no log for today..."})]}),(0,s.jsx)(i.aY,{className:"h-[100px] flex items-center justify-center text-muted-foreground",children:"Waiting for data..."})]});if(!a)return(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Today's Target Progress"}),(0,s.jsxs)(i.SZ,{className:"text-destructive flex items-center gap-1",children:[(0,s.jsx)(o.Z,{className:"h-4 w-4"})," No active UPH target found."]})]}),(0,s.jsx)(i.aY,{className:"h-[100px] flex items-center justify-center text-muted-foreground",children:"Activate a target to track progress."})]});let d=(0,C.Qc)(t.date,"yyyy-MM-dd",new Date),c=(0,h.J)(d)?(0,j.WU)(d,"MMM d"):t.date,m=t.trainingDurationMinutes&&t.trainingDurationMinutes>0?(0,N.BQ)(60*t.trainingDurationMinutes):null;return(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Today's Target Progress"}),(0,s.jsxs)(i.SZ,{children:["Tracking progress towards"," ",(0,s.jsx)("span",{className:"font-medium",children:a.name})," target (Goal UPH:"," ",a.targetUPH.toFixed(1),") for ",c,".",m&&(0,s.jsxs)("span",{className:"block text-xs text-muted-foreground",children:[(0,s.jsx)(T.Z,{className:"inline-block h-3 w-3 mr-1"})," Includes ",m," of training."]})]})]}),(0,s.jsxs)(i.aY,{className:"space-y-3 pt-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(S,{value:n.percentage,"aria-label":"".concat(n.percentage,"% complete towards target units"),className:"h-3 flex-1"}),(0,s.jsxs)("span",{className:"font-semibold tabular-nums",children:[n.percentage,"%"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-x-4 gap-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Units Now"}),(0,s.jsx)("span",{className:"font-medium tabular-nums",children:n.currentUnits.toFixed(2)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Target Units"}),(0,s.jsx)("span",{className:"font-medium tabular-nums",children:n.targetUnits.toFixed(2)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Current UPH"}),(0,s.jsx)("span",{className:"font-medium tabular-nums",children:n.currentUPH.toFixed(2)})]}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Units to Goal"}),(0,s.jsx)("span",{className:"font-medium tabular-nums",children:n.goalMetTime?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.Z,{className:"inline-block h-4 w-4 mr-1 text-green-600 dark:text-green-500"})," Met"]}):n.unitsToGoal>0?n.unitsToGoal.toFixed(2):"0.00"})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:col-span-2",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Schedule Status"}),(0,s.jsx)("span",{className:(0,N.cn)("font-medium tabular-nums",n.goalMetTime&&"text-green-600 dark:text-green-500",!n.goalMetTime&&null!==n.timeDiff&&n.timeDiff>=0&&"text-green-600 dark:text-green-500",!n.goalMetTime&&null!==n.timeDiff&&n.timeDiff<0&&"text-red-600 dark:text-red-500"),children:n.goalMetTime?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.Z,{className:"inline-block h-4 w-4 mr-1"}),"Met at ".concat((0,j.WU)(n.goalMetTime,"h:mm:ss a"))]}):(0,N.Gw)(n.timeDiff)})]}),(0,s.jsxs)("div",{className:"flex flex-col col-span-2 sm:col-span-2",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Est. Goal Hit Time"}),(0,s.jsx)("span",{className:"font-medium tabular-nums",children:n.goalMetTime?"-":n.projectedHitTimeFormatted})]})]})]})]})},z=a(61016),U=a(70402),F=a(77209),H=a(77424),A=a(92513),P=a(39451),_=a(44378),E=a(5891),L=a(88002),Z=a(58758),O=a(30690),I=a(40472),Y=a(86763),W=a(2183),G=a(29943),R=a(21493);function B(){let[e,t]=(0,l.useState)([]),[a,n]=(0,l.useState)([]),[o,m]=(0,l.useState)(null),[u,x]=(0,l.useState)(!0),[f,g]=(0,l.useState)(""),[p,h]=(0,l.useState)(""),[v,j]=(0,l.useState)(!1),[w,y]=(0,l.useState)(!1),{toast:k}=(0,Y.pm)(),[S,C]=(0,l.useState)(!1),[D,B]=(0,l.useState)(null),[q,Q]=(0,l.useState)(null);(0,l.useEffect)(()=>{C(!0);{Q(new Date);let e=setInterval(()=>Q(new Date),1e3);return()=>clearInterval(e)}},[]);let V=(0,l.useCallback)(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(S){e&&x(!0),console.log("[Home Page] loadData triggered.");try{var a,s,l,r;let e=(0,z.W1)(),i=(0,z.Gq)(),o=(0,z.Io)(),d=(0,z.cQ)(),c=(0,z.Ok)();t(e),n(i),m(o),j(e.length>0||i.length>0),y(d),B(c);let u=(0,N._3)(new Date),x=e.find(e=>e.date===u&&!e.isFinalized);g(null!==(l=null==x?void 0:null===(a=x.documentsCompleted)||void 0===a?void 0:a.toString())&&void 0!==l?l:""),h(null!==(r=null==x?void 0:null===(s=x.videoSessionsCompleted)||void 0===s?void 0:s.toString())&&void 0!==r?r:""),console.log("[Home Page] Data loaded. Active target:",null==o?void 0:o.name,"Sample Data Loaded:",d,"Settings:",c)}catch(e){console.error("[Home] Error loading data:",e),k({variant:"destructive",title:"Error Loading Data",description:"Could not load work logs or targets from local storage."}),j(!1),y(!1),B((0,z.Ok)())}finally{e&&x(!1)}}},[k,S]);(0,l.useEffect)(()=>{S&&(console.log("[Home Page] useEffect triggered due to isClient change."),V())},[S,V]);let $=null;if(S){let t=(0,N._3)(new Date);$=e.find(e=>e.date===t&&!e.isFinalized)||null}(0,l.useEffect)(()=>{var t,a,s,l;if(!S)return;let r=(0,N._3)(new Date),i=e.find(e=>e.date===r&&!e.isFinalized)||null;g(null!==(s=null==i?void 0:null===(t=i.documentsCompleted)||void 0===t?void 0:t.toString())&&void 0!==s?s:""),h(null!==(l=null==i?void 0:null===(a=i.videoSessionsCompleted)||void 0===a?void 0:a.toString())&&void 0!==l?l:"")},[e,S]),(0,l.useEffect)(()=>{if(!S||!(null==D?void 0:D.autoSwitchTargetBySchedule)||!$||!o||!q||0===a.length)return;let e=a.filter(e=>{var t;return null===(t=e.isDisplayed)||void 0===t||t});if(0===e.length)return;let t=null,s=1/0;for(let a of e){let e=(0,N.mS)($,a,q);if(null!==e){let l=Math.abs(e);l<s&&(s=l,t=a)}}if(t&&t.id!==o.id){console.log('[AutoSwitch] Switching to target "'.concat(t.name,"\" as it's closest to schedule."));try{let e=(0,z.eU)(t.id);m(e),n(t=>t.map(t=>({...t,isActive:t.id===e.id}))),k({title:"Target Switched",description:'Auto-switched to target "'.concat(e.name,'".'),duration:3e3})}catch(e){console.error("[AutoSwitch] Error setting active target:",e),k({variant:"destructive",title:"Auto-Switch Failed",description:"Could not automatically switch target."})}}},[S,D,$,o,q,a,k]);let J=(0,l.useCallback)((a,s)=>{if(!S)return{};try{let l=(0,z.zn)(a,s);if(t(e=>{let t;let a=e.findIndex(e=>e.id===l.id);return a>-1?(t=[...e])[a]=l:t=[...e,l],t.sort((e,t)=>t.date.localeCompare(e.date))}),j(!0),"UPDATE_WORK_LOG_GOAL_MET"!==s){let t=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null;a.id===(null==t?void 0:t.id)?k({title:"Log Updated",description:"Today's log (".concat(a.date,") was updated.")}):K(a,e)&&k({title:"Log Created",description:"Log for ".concat(a.date," created.")})}return l}catch(e){throw console.error("[Home] Error saving work log:",e),k({variant:"destructive",title:"Save Failed",description:e instanceof Error?e.message:"Could not save the work log."}),e}},[k,S,e]),K=(e,t)=>e.id?!t.some(t=>t.id===e.id):!t.some(t=>t.date===e.date&&!t.isFinalized),X=(0,l.useCallback)(e=>{if(S)try{(0,z.Rd)(e),V(!1),k({title:"Log Deleted",description:"Work log deleted successfully."})}catch(e){throw console.error("[Home] Error deleting work log:",e),k({variant:"destructive",title:"Deletion Failed",description:e instanceof Error?e.message:"Could not delete the work log."}),e}},[V,k,S]),ee=(t,a)=>{let s;if(!S)return;let l=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null;if(!l){console.warn("[Home] Quick Update: No active log found for today to update."),k({variant:"destructive",title:"Quick Update Failed",description:"No active work log found for today. Add one on the 'Log / Targets' page or click 'Start New Day'."});return}let r=l.documentsCompleted||0,i=l.videoSessionsCompleted||0,n="documentsCompleted"===t?r:i;if("string"==typeof a){if(isNaN(s=""===a.trim()?0:parseInt(a,10))){"documentsCompleted"===t&&g(n.toString()),"videoSessionsCompleted"===t&&h(n.toString()),k({variant:"destructive",title:"Invalid Input",description:"Please enter a valid number."});return}}else s=n+a;if(s<0){s=0,k({variant:"default",title:"Limit Reached",description:"Cannot decrease ".concat("documentsCompleted"===t?"documents":"videos"," below zero.")}),"string"==typeof a&&("documentsCompleted"===t&&g("0"),"videoSessionsCompleted"===t&&h("0"));return}let o={id:l.id,date:l.date,startTime:l.startTime,endTime:l.endTime,hoursWorked:l.hoursWorked,documentsCompleted:"documentsCompleted"===t?s:r,videoSessionsCompleted:"videoSessionsCompleted"===t?s:i,breakDurationMinutes:l.breakDurationMinutes,trainingDurationMinutes:l.trainingDurationMinutes,targetId:l.targetId,notes:l.notes,goalMetTimes:l.goalMetTimes||{},isFinalized:l.isFinalized};try{J(o,"UPDATE_WORK_LOG_QUICK_COUNT"),k({title:"Count Updated",description:"Today's ".concat("documentsCompleted"===t?"document":"video"," count set to ").concat(s,".")})}catch(e){"string"==typeof a&&("documentsCompleted"===t&&g(n.toString()),"videoSessionsCompleted"===t&&h(n.toString()))}},et=(0,l.useCallback)(()=>{var t,a;if(!S||!D)return;let s=(0,z.Io)();if(!s){k({variant:"destructive",title:"Cannot Start New Day",description:"No active UPH target found. Please set one on the 'Log / Targets' page."});return}let l=(0,N._3)(new Date);if(e.find(e=>e.date===l&&!e.isFinalized)){k({title:"Day Already Started",description:"An active work log already exists for today."});return}let r=D.defaultStartTime||"14:00",i=D.defaultEndTime||"22:30",n=null!==(t=D.defaultBreakMinutes)&&void 0!==t?t:0,o=null!==(a=D.defaultTrainingMinutes)&&void 0!==a?a:0,d=(0,N.fH)(l,r,i,n+o),c={date:l,startTime:r,endTime:i,breakDurationMinutes:n,trainingDurationMinutes:o,hoursWorked:d,documentsCompleted:0,videoSessionsCompleted:0,targetId:s.id,notes:"New day started from dashboard.",goalMetTimes:{},isFinalized:!1};try{J(c,"CREATE_WORK_LOG"),k({title:"New Day Started",description:"Work log for ".concat(l," created with default times.")})}catch(e){}},[J,k,S,e,D]),ea=(0,l.useCallback)(()=>{if(!S)return;if(!e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)){k({variant:"destructive",title:"No Active Log to End",description:"No active work log found for today to mark as finalized."});return}if(!window.confirm("Are you sure you want to finalize today's log? You won't be able to make further quick updates or add break/training time from the dashboard."))return;let t=(0,z.MR)();t?(k({title:"Day Finalized",description:"Log for ".concat(t.date," has been finalized. View in 'Previous Logs'.")}),V(!1)):k({variant:"destructive",title:"Finalize Day Failed",description:"Could not finalize today's log. It might have already been processed or an error occurred."})},[e,V,k,S]),es=(0,l.useCallback)(a=>{if(!S)return;let s=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null;if(!s){k({variant:"destructive",title:"Cannot Add Break",description:"No active work log found for today. Start a new day first."});return}try{let e=(0,z.FU)(s.id,a);t(t=>{let a=t.findIndex(t=>t.id===e.id);if(a>-1){let s=[...t];return s[a]=e,s}return t}),k({title:"Break Added",description:"".concat(a," minutes added to your break time. Total break: ").concat((0,N.BQ)(60*e.breakDurationMinutes),".")})}catch(e){console.error("[Home] Error adding break:",e),k({variant:"destructive",title:"Add Break Failed",description:e instanceof Error?e.message:"Could not add break time."})}},[k,S,e]),el=(0,l.useCallback)(a=>{if(!S)return;let s=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null;if(!s){k({variant:"destructive",title:"Cannot Add Training",description:"No active work log found for today. Start a new day first."});return}try{let e=(0,z.q3)(s.id,a);t(t=>{let a=t.findIndex(t=>t.id===e.id);if(a>-1){let s=[...t];return s[a]=e,s}return t}),k({title:"Training Time Added",description:"".concat(a," minutes added to your training time. Total training: ").concat((0,N.BQ)(60*(e.trainingDurationMinutes||0)),".")})}catch(e){console.error("[Home] Error adding training:",e),k({variant:"destructive",title:"Add Training Failed",description:e instanceof Error?e.message:"Could not add training time."})}},[k,S,e]),er=(0,l.useCallback)((e,a)=>{S&&(console.log("[Home] Received goal met notification for target ".concat(e," at ").concat(a.toISOString())),t(t=>{let s=t.findIndex(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized);if(!(s>-1))return console.warn("[Home] Goal met handler called, but no active log found for today."),t;{let l=t[s];if(!a||!(a instanceof Date)||isNaN(a.getTime()))return console.error("[Home] Goal met handler received invalid 'metAt' date:",a),t;let r=a.toISOString();if(l.goalMetTimes&&l.goalMetTimes[e])return console.log("[Home] Goal met time ALREADY recorded for target ".concat(e," in log's goalMetTimes. Ignoring redundant notification.")),t;{console.log("[Home] Persisting goal met time for target ".concat(e,"..."));let a={...l.goalMetTimes||{},[e]:r},i={...l,goalMetTimes:a};try{let a=(0,z.zn)(i,"UPDATE_WORK_LOG_GOAL_MET"),l=[...t];l[s]=a;let r=(0,z.Gq)().find(t=>t.id===e),n=r?r.name:e;return k({title:"\uD83C\uDF89 Goal Met!",description:"You've met the goal for target: \"".concat(n,'"!')}),l.sort((e,t)=>t.date.localeCompare(e.date))}catch(a){return console.error("[Home] Error saving goal met time for target ".concat(e,":"),a),k({variant:"destructive",title:"Goal Met Update Failed",description:'Could not record that goal for "'.concat(e,'" was met.')}),t}}}}))},[S,k]),ei=(0,l.useCallback)(e=>{if(!S||(null==o?void 0:o.id)===e)return{};try{let t=(0,z.eU)(e);return n(e=>e.map(e=>({...e,isActive:e.id===t.id}))),m(t),k({title:"Target Activated",description:'"'.concat(t.name,'" is now the active target for dashboard progress.')}),t}catch(e){throw console.error("[Home] Error setting active target:",e),k({variant:"destructive",title:"Activation Failed",description:e instanceof Error?e.message:"Could not activate the target."}),e}},[k,S,o]);return!S||u?(0,s.jsxs)("div",{className:"w-full max-w-7xl mx-auto space-y-8 p-4 md:p-6 lg:p-8",children:[(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-6 md:mb-8 text-center",children:"Daily Dashboard"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,s.jsx)(W.O,{className:"h-[250px] md:col-span-2 lg:col-span-2 w-full"}),(0,s.jsx)(W.O,{className:"h-[250px] w-full"})]}),(0,s.jsx)(W.O,{className:"h-[180px] w-full"}),(0,s.jsx)(W.O,{className:"h-[300px] w-full"})]}):v?(0,s.jsxs)("div",{className:"w-full max-w-7xl mx-auto space-y-8 p-4 md:p-6 lg:p-8",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-6 md:mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-center sm:text-left",children:"Daily Dashboard"}),w&&(0,s.jsxs)(G.aR,{children:[(0,s.jsx)(G.vW,{asChild:!0,children:(0,s.jsxs)(c.z,{variant:"outline",children:[(0,s.jsx)(_.Z,{className:"mr-2 h-4 w-4"})," Clear Sample Data & Start Fresh"]})}),(0,s.jsxs)(G._T,{children:[(0,s.jsxs)(G.fY,{children:[(0,s.jsx)(G.f$,{children:"Ready to track your own data?"}),(0,s.jsx)(G.yT,{children:"This will remove all sample work logs and targets. Are you sure you want to continue?"})]}),(0,s.jsxs)(G.xo,{children:[(0,s.jsx)(G.le,{children:"Cancel"}),(0,s.jsx)(G.OL,{onClick:()=>{if(S)try{(0,z._X)(),k({title:"Data Cleared",description:"Sample data removed. Starting fresh!"}),V()}catch(e){console.error("[Home] Error clearing sample data:",e),k({variant:"destructive",title:"Clear Data Error",description:e instanceof Error?e.message:"Could not clear data."})}},children:"Yes, Clear and Start"})]})]})]}),$&&!w&&(0,s.jsxs)(c.z,{onClick:ea,variant:"outline",size:"sm",disabled:u,children:[(0,s.jsx)(E.Z,{className:"mr-2 h-4 w-4"})," Finalize Today's Log"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 items-start",children:[(0,s.jsxs)(i.Zb,{className:"md:col-span-2",children:[(0,s.jsxs)(i.Ol,{children:[(0,s.jsx)(i.ll,{children:"Quick Update Today's Counts"}),$?(0,s.jsxs)(i.SZ,{children:["Log Date: ",(0,N._3)(new Date)," (Active Log)"]}):(0,s.jsx)(i.SZ,{className:"text-muted-foreground",children:"No active log started for today."})]}),(0,s.jsxs)(i.aY,{className:"flex flex-col sm:flex-row gap-6 sm:gap-8 items-center justify-center py-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(U._,{htmlFor:"quick-update-docs-input",className:"min-w-[80px] sm:min-w-[auto]",children:"Documents:"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(c.z,{id:"quick-update-docs-minus","aria-label":"Decrease document count",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ee("documentsCompleted",-1),disabled:u||!$,children:[" ",(0,s.jsx)(L.Z,{className:"h-4 w-4"})," "]}),(0,s.jsx)(F.I,{id:"quick-update-docs-input",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:f,onChange:e=>{let t=e.target.value;/^\d*$/.test(t)&&g(t)},onBlur:()=>{var t,a;if(!S)return;let s=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null,l=null!==(a=null==s?void 0:null===(t=s.documentsCompleted)||void 0===t?void 0:t.toString())&&void 0!==a?a:"0",r=""===f.trim()?"0":f.trim();""===r&&g("0"),s&&r!==l?ee("documentsCompleted",r):s||"0"===r||g("")},className:"h-9 w-16 text-center tabular-nums text-lg font-medium appearance-none",disabled:u||!$,"aria-label":"Document count input"}),(0,s.jsxs)(c.z,{id:"quick-update-docs-plus","aria-label":"Increase document count",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ee("documentsCompleted",1),disabled:u||!$,children:[" ",(0,s.jsx)(A.Z,{className:"h-4 w-4"})," "]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,s.jsx)(U._,{htmlFor:"quick-update-videos-input",className:"min-w-[80px] sm:min-w-[auto]",children:"Videos:"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(c.z,{id:"quick-update-videos-minus","aria-label":"Decrease video count",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ee("videoSessionsCompleted",-1),disabled:u||!$,children:[" ",(0,s.jsx)(L.Z,{className:"h-4 w-4"})," "]}),(0,s.jsx)(F.I,{id:"quick-update-videos-input",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:p,onChange:e=>{let t=e.target.value;/^\d*$/.test(t)&&h(t)},onBlur:()=>{var t,a;if(!S)return;let s=e.find(e=>e.date===(0,N._3)(new Date)&&!e.isFinalized)||null,l=null!==(a=null==s?void 0:null===(t=s.videoSessionsCompleted)||void 0===t?void 0:t.toString())&&void 0!==a?a:"0",r=""===p.trim()?"0":p.trim();""===r&&h("0"),s&&r!==l?ee("videoSessionsCompleted",r):s||"0"===r||h("")},className:"h-9 w-16 text-center tabular-nums text-lg font-medium appearance-none",disabled:u||!$,"aria-label":"Video count input"}),(0,s.jsxs)(c.z,{id:"quick-update-videos-plus","aria-label":"Increase video count",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ee("videoSessionsCompleted",1),disabled:u||!$,children:[" ",(0,s.jsx)(A.Z,{className:"h-4 w-4"})," "]})]})]})]}),(0,s.jsxs)(i.eW,{className:"flex flex-col items-center gap-2 pt-2 pb-4",children:[(0,s.jsx)(U._,{className:"text-sm font-medium",children:"Log Non-Work Time"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>es(15),disabled:u||!$,children:[(0,s.jsx)(Z.Z,{className:"mr-2 h-4 w-4"})," Break (15m)"]}),(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>es(30),disabled:u||!$,children:[(0,s.jsx)(Z.Z,{className:"mr-2 h-4 w-4"})," Lunch (30m)"]}),(0,s.jsxs)(c.z,{variant:"outline",size:"sm",onClick:()=>el(5),disabled:u||!$,children:[(0,s.jsx)(T.Z,{className:"mr-2 h-4 w-4"})," Train (5m)"]})]}),$&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Current Break: ",(0,N.BQ)(60*$.breakDurationMinutes),$.trainingDurationMinutes&&$.trainingDurationMinutes>0&&" | Training: ".concat((0,N.BQ)(60*$.trainingDurationMinutes))]})]})]}),(0,s.jsx)(b,{allWorkLogs:e,targets:a,activeTarget:o}),!$&&(0,s.jsxs)(i.Zb,{className:"border-dashed border-muted-foreground md:col-span-3",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-muted-foreground",children:"Start Your Day"})}),(0,s.jsxs)(i.aY,{className:"flex flex-col items-center justify-center min-h-[150px] py-6 text-muted-foreground gap-4",children:[(0,s.jsx)(O.Z,{className:"h-8 w-8"}),(0,s.jsxs)("p",{className:"text-center max-w-xs",children:["No active work log found for today (",(0,N._3)(new Date),")."]}),(0,s.jsxs)(c.z,{onClick:et,disabled:u||!o,children:[(0,s.jsx)(I.Z,{className:"mr-2 h-5 w-5"})," Start New Day"]}),!o&&(0,s.jsx)("p",{className:"text-xs text-destructive",children:" (Set an active target first)"})]})]})]}),$&&o&&q&&(0,s.jsx)(M,{todayLog:$,activeTarget:o,currentTime:q}),$&&(0,s.jsx)(d,{initialWorkLogs:$?[$]:[],initialUphTargets:a,initialActiveTarget:o,deleteWorkLogAction:X,setActiveUPHTargetAction:ei,onGoalMet:er}),!$&&v&&!u&&(0,s.jsx)(s.Fragment,{})]}):(0,s.jsxs)("div",{className:"w-full max-w-3xl mx-auto space-y-8 p-4 md:p-6 lg:p-8 text-center flex flex-col items-center justify-center min-h-[calc(100vh-15rem)]",children:[(0,s.jsx)(H.Z,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,s.jsx)("h1",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Welcome to Metric Daily!"}),(0,s.jsx)("p",{className:"text-lg text-muted-foreground mb-6",children:"It looks like you don't have any data yet. You can load sample data to explore, or follow the guide to set up your own tracking."}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[(0,s.jsxs)(c.z,{onClick:()=>{if(S)try{(0,z.iX)()?(k({title:"Sample Data Loaded",description:"Sample work logs and targets have been added."}),V()):k({title:"Sample Data Skipped",description:"Existing data found. Sample data was not loaded."})}catch(e){console.error("[Home] Error loading sample data:",e),k({variant:"destructive",title:"Sample Data Error",description:e instanceof Error?e.message:"Could not load sample data."})}},size:"lg",children:[(0,s.jsx)(A.Z,{className:"mr-2 h-5 w-5"})," Load Sample Data"]}),(0,s.jsx)(c.z,{asChild:!0,size:"lg",variant:"outline",children:(0,s.jsxs)(r.default,{href:"/log-input",children:[(0,s.jsx)(P.Z,{className:"mr-2 h-5 w-5"})," Set Up & Start Tracking"]})})]}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(R.default,{contextualTriggerText:"View App Guide"})}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-4",children:"To start tracking, you'll need to define at least one UPH Target and log your first day's work on the 'Log / Targets' page."})]})}},29943:function(e,t,a){"use strict";a.d(t,{OL:function(){return h},_T:function(){return u},aR:function(){return o},f$:function(){return g},fY:function(){return x},le:function(){return v},vW:function(){return d},xo:function(){return f},yT:function(){return p}});var s=a(57437),l=a(2265),r=a(76669),i=a(49354),n=a(89733);let o=r.fC,d=r.xz,c=r.h_,m=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.aV,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l,ref:t})});m.displayName=r.aV.displayName;let u=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(m,{}),(0,s.jsx)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...l})]})});u.displayName=r.VY.displayName;let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};x.displayName="AlertDialogHeader";let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};f.displayName="AlertDialogFooter";let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold",a),...l})});g.displayName=r.Dx.displayName;let p=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...l})});p.displayName=r.dk.displayName;let h=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.aU,{ref:t,className:(0,i.cn)((0,n.d)(),a),...l})});h.displayName=r.aU.displayName;let v=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.$j,{ref:t,className:(0,i.cn)((0,n.d)({variant:"outline"}),"mt-2 sm:mt-0",a),...l})});v.displayName=r.$j.displayName},8120:function(e,t,a){"use strict";a.d(t,{h:function(){return v}});var s=a(57437),l=a(2265),r=a(1282),i=a(22468),n=a(49354),o=a(89733),d=a(16876),c=a(54817);a(54662);let m=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(d.mY,{ref:t,className:(0,n.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...l})});m.displayName=d.mY.displayName;let u=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,s.jsx)(c.Z,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,s.jsx)(d.mY.Input,{ref:t,className:(0,n.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...l})]})});u.displayName=d.mY.Input.displayName;let x=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(d.mY.List,{ref:t,className:(0,n.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...l})});x.displayName=d.mY.List.displayName;let f=l.forwardRef((e,t)=>(0,s.jsx)(d.mY.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));f.displayName=d.mY.Empty.displayName;let g=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(d.mY.Group,{ref:t,className:(0,n.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...l})});g.displayName=d.mY.Group.displayName,l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(d.mY.Separator,{ref:t,className:(0,n.cn)("-mx-1 h-px bg-border",a),...l})}).displayName=d.mY.Separator.displayName;let p=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(d.mY.Item,{ref:t,className:(0,n.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",a),...l})});p.displayName=d.mY.Item.displayName;var h=a(21413);function v(e){var t,a;let{options:d,value:c,onSelect:v,placeholder:j="Select an option...",searchPlaceholder:N="Search...",notFoundText:w="No options found.",triggerClassName:y,disabled:b=!1}=e,[k,S]=l.useState(!1);return(0,s.jsxs)(h.J2,{open:k,onOpenChange:S,children:[(0,s.jsx)(h.xo,{asChild:!0,children:(0,s.jsxs)(o.z,{variant:"outline",role:"combobox","aria-expanded":k,className:(0,n.cn)("w-full justify-between text-sm h-9 font-normal",y),disabled:b,children:[(0,s.jsx)("span",{className:"truncate",children:c&&null!==(a=null===(t=d.find(e=>e.value===c))||void 0===t?void 0:t.label)&&void 0!==a?a:j}),(0,s.jsx)(r.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(h.yk,{className:"w-[--radix-popover-trigger-width] max-h-[--radix-popover-content-available-height] p-0",children:(0,s.jsxs)(m,{children:[(0,s.jsx)(u,{placeholder:N}),(0,s.jsxs)(x,{children:[(0,s.jsx)(f,{children:w}),(0,s.jsx)(g,{children:d.map(e=>(0,s.jsxs)(p,{value:e.label,onSelect:e=>{let t=d.find(t=>t.label.toLowerCase()===e.toLowerCase());t&&v(t.value),S(!1)},children:[(0,s.jsx)(i.Z,{className:(0,n.cn)("mr-2 h-4 w-4",c===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})]})]})})]})}},70402:function(e,t,a){"use strict";a.d(t,{_:function(){return d}});var s=a(57437),l=a(2265),r=a(38364),i=a(13027),n=a(49354);let o=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)(r.f,{ref:t,className:(0,n.cn)(o(),a),...l})});d.displayName=r.f.displayName},2183:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});var s=a(57437),l=a(49354);function r(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("animate-pulse rounded-md bg-muted",t),...a})}}},function(e){e.O(0,[472,631,767,17,902,596,476,969,733,544,493,37,971,23,744],function(){return e(e.s=96981)}),_N_E=e.O()}]);